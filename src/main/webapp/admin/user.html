<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>前台用户管理</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link href="assets/css/bootstrap.min.css" rel="stylesheet" />
	<link rel="stylesheet" href="assets/css/jquery-ui-1.10.3.full.min.css" />
	<link rel="stylesheet" href="assets/css/datepicker.css" />
	<link rel="stylesheet" href="assets/css/ui.jqgrid.css" />
	<link rel="stylesheet" href="assets/css/ace.min.css" />
	<link rel="stylesheet" href="assets/css/ace-rtl.min.css" />
	<link rel="stylesheet" href="assets/css/ace-skins.min.css" />
	<script src="assets/js/ace-extra.min.js"></script>
	<link rel="stylesheet" href="jquery-easyui-1.5.2/themes/bootstrap/easyui.css" type="text/css"></link>
	<link rel="stylesheet" href="jquery-easyui-1.5.2/themes/icon.css" type="text/css"></link>
	<script type="text/javascript" src="jquery-easyui-1.5.2/jquery.min.js"></script>
	<script type="text/javascript" src="jquery-easyui-1.5.2/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="jquery-easyui-1.5.2/locale/easyui-lang-zh_CN.js"></script>
	<script src="assets/js/ace-extra.min.js"></script>
	<script src="assets/js/cookie.js"></script>
	<style>
		#add_grid-table{
			display:none;
		}
	</style>
</head>

<body>
<div class="navbar navbar-default" id="navbar">
	<script type="text/javascript">
        try{ace.settings.check('navbar' , 'fixed')}catch(e){}
	</script>
	<div class="navbar-container" id="navbar-container">
		<div class="navbar-header pull-left">
			<a href="#" class="navbar-brand">
				<small>
					<i class="icon-logo"></i>
					H5游戏平台后台管理系统
				</small>
			</a><!-- /.brand -->
		</div><!-- /.navbar-header -->

		<div class="navbar-header pull-right" role="navigation">
			<ul class="nav ace-nav">
				<li class="light-blue">
					<a data-toggle="dropdown" href="#" class="dropdown-toggle">
                                    <span class="user-info">
                                        <small>欢迎光临,</small>
                                        <small id="adminName"></small>
                                    </span>

						<i class="icon-caret-down"></i>
					</a>
					<ul class="user-menu pull-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">
						<li>
							<a href="#">
								<i class="icon-cog"></i>
								设置
							</a>
						</li>

						<li>
							<a href="#">
								<i class="icon-user"></i>
								个人资料
							</a>
						</li>

						<li class="divider"></li>

						<li class="logout">
							<a href="#" >
								<i class="icon-off"></i>
								退出
							</a>
						</li>
					</ul>
				</li>
			</ul><!-- /.ace-nav -->
		</div><!-- /.navbar-header -->
	</div><!-- /.container -->
</div>
<div class="main-container" id="main-container">
	<script type="text/javascript">
        try{ace.settings.check('main-container' , 'fixed')}catch(e){}
	</script>

	<div class="main-container-inner">
		<a class="menu-toggler" id="menu-toggler" href="#">
			<span class="menu-text"></span>
		</a>

		<div class="sidebar" id="sidebar">
			<script type="text/javascript">
                try{ace.settings.check('sidebar' , 'fixed')}catch(e){}
			</script>

			<ul class="nav nav-list">
				<li>
					<a href="#" class="dropdown-toggle">
                                <span class="menu-text">
                                    系统管理
                                </span>

						<b class="arrow icon-angle-down"></b>
					</a>

					<ul class="submenu">
						<li>
							<a href="#">
								<i class="icon-double-angle-right"></i>
								系统配置
							</a>
						</li>

						<li>
							<a href="#">
								<i class="icon-double-angle-right"></i>
								权限管理
							</a>
						</li>
					</ul>
				</li>

				<li class="active open">
					<a href="#" class="dropdown-toggle">
                                <span class="menu-text">
                                    用户管理
                                </span>

						<b class="arrow icon-angle-down"></b>
					</a>
					<ul class="submenu">
						<li class="active">
							<a href="user.html">
								<i class="icon-double-angle-right"></i>
								前台用户管理
							</a>
						</li>

						<li>
							<a href="admin.html">
								<i class="icon-double-angle-right"></i>
								后台用户管理
							</a>
						</li>
					</ul>
				</li>

				<li>
					<a href="#" class="dropdown-toggle">
                                <span class="menu-text">
                                    微信管理
                                </span>

						<b class="arrow icon-angle-down"></b>
					</a>

					<ul class="submenu">
						<li>
							<a href="wxUser.html">
								<i class="icon-double-angle-right"></i>
								微信用户管理
							</a>
						</li>

						<li>
							<a href="wxMenu.html">
								微信菜单管理
							</a>
						</li>
					</ul>
				</li>

				<li>
					<a href="game.html" class="dropdown-toggle">
                                <span class="menu-text">
                                    游戏管理
                                </span>
					</a>
				</li>

				<li>
					<a href="comments.html" class="dropdown-toggle">
                                <span class="menu-text">
                                    评论管理
                                </span>
					</a>
				</li>

				<li class="logout">
					<a href="login.html" class="dropdown-toggle">
                                <span class="menu-text">
                                    退出系统
                                </span>
					</a>
				</li>
			</ul><!-- /.nav-list -->

			<div class="sidebar-collapse" id="sidebar-collapse">
				<i class="icon-double-angle-left" data-icon1="icon-double-angle-left" data-icon2="icon-double-angle-right"></i>
			</div>

			<script type="text/javascript">
                try{ace.settings.check('sidebar' , 'collapsed')}catch(e){}
			</script>
		</div>

		<div class="main-content">
			<div class="breadcrumbs" id="breadcrumbs">
				<script type="text/javascript">
                    try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
				</script>

				<ul class="breadcrumb">
					<li>
						<i class="icon-home home-icon"></i>
						<a href="#">主页</a>
					</li>

					<li>
						<a href="#">用户管理</a>
					</li>

					<li class="active">
						<a href="admin.html">后台用户管理</a>
					</li>
				</ul><!-- .breadcrumb -->
			</div>

			<div class="page-content">
				<div class="page-header">
					<h1>
						后台用户管理
						<small>
							<i class="icon-double-angle-right"></i>
							查看
						</small>
					</h1>
				</div><!-- /.page-header -->

				<div class="row">
					<div class="col-xs-12">
						<table id="dg"></table>
						<div id="userDialog" style="display: none;overflow: hidden;background:#FFFFFF">
							<form id="userForm" method="post">
								<table class="tableForm" style="margin-left:30px;margin-top:30px;">
									<tr style="display:none;">
										<th width="80">用户ID</th>
										<td><input name="id" id="id" /></td>
									</tr>
									<tr>
										<th>avatar：</th>
										<td><input id="avatar" name="avatar"  style="width: 196px;" class="easyui-validatebox" validType="length[1,200]"/></td>
									</tr>
									<tr>
										<th>email：</th>
										<td><input id="email" name="email"  style="width: 196px;" class="easyui-validatebox" validType="length[1,200]"/></td>
									</tr>
									<tr>
										<th>integarl：</th>
										<td><input id="integral" name="integral"  style="width: 196px;" class="easyui-validatebox" validType="length[1,200]"/></td>
									</tr>
									<tr>
										<th>locaked：</th>
										<td>
											<select id="locked" class="easyui-combobox" name="locked" tyle="width: 196px;">
												<option value="true">YES</option>
												<option value="false">NO</option>
											</select>
										</td>
										<!--<td><input id="locked" name="locked"  style="width: 196px;" class="easyui-validatebox" validType="length[1,200]"/></td>-->
									</tr>
									<tr>
										<th>password：</th>
										<td><input id="password" name="password"  style="width: 196px;" class="easyui-validatebox" validType="length[1,200]"/></td>
									</tr>
									<tr>
										<th>top：</th>
										<td><input id="top" name="top"  style="width: 196px;" class="easyui-validatebox" validType="length[1,200]"/></td>
									</tr>
									<tr>
										<th>user：</th>
										<td><input id="user" name="user"  style="width: 196px;" class="easyui-validatebox" validType="length[1,200]"/></td>
									</tr>
									<tr>
										<th>wechat：</th>
										<td><input id="wechat" name="wechat"  style="width: 196px;" class="easyui-validatebox" validType="length[1,200]"/></td>
									</tr>
								</table>
							</form>
						</div>
					</div><!-- /.col -->
				</div><!-- /.row -->
			</div><!-- /.page-content -->
		</div><!-- /.main-content -->
	</div><!-- /.main-container-inner -->

	<a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
		<i class="icon-double-angle-up icon-only bigger-110"></i>
	</a>
</div><!-- /.main-container -->
<script type="text/javascript">
    window.jQuery || document.write("<script src='assets/js/jquery-2.0.3.min.js'>"+"<"+"/script>");
</script>
<script type="text/javascript">
    if("ontouchend" in document) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
</script>
<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/typeahead-bs2.min.js"></script>
<script src="assets/js/date-time/bootstrap-datepicker.min.js"></script>
<script src="assets/js/ace-elements.min.js"></script>
<script src="assets/js/ace.min.js"></script>
<script type="text/javascript" src="assets/js/cookie.js"></script>
<script type="text/javascript" src="assets/js/logout.js"></script>
<script type="text/javascript">
    $(function(){
        $("#adminName").text(getCookie("adminName"));
    });
</script>
<script type="text/javascript">
    var userDialog ;
    var userForm ;
    function add(){
        userDialog = $('#userDialog').show().dialog({
            modal : true,
            title : '用户信息',
            width:400,
            height:500,
            buttons : [ {
                text : '确定',
                style:'text-align:center',
                handler : function() {
                    save();
                }
            } ]
        }).dialog('open');
    }

    function save(){
        var userForm = $('#userForm').form();
        if(userForm.form('validate')){
            var formData={
                id:$('#id').val(),
                avatar:$("#avatar").val(),
                email:$("#email").val(),
                integral:$("#integral").val(),
                locked:$("#locked").val(),
                password:$("#password").val(),
                top:$("#top").val(),
                user:$("#user").val(),
                wechat:$("#wechat").val(),
                token:getCookie("token")
            };

            var url="";
            var msg = "新增";
            if($("[name='xyz']").is(':checked')){
                url="/manage/lockedUser";
                var formDataE={
                    userId:$('#id').val(),
                    locked:$("#locked").val(),
                    token:getCookie("token")
                };
                formData = formDataE;
                msg = "修改";
            }else{
                url = "announcement/add";
//						formData = formDataA;
            }
            $.ajax({
                type:'post',
                url:url,
//						data:JSON.stringify(formData),
                data:formData,
//						contentType:"application/json",
                success:function(result){
                    if (result.status == true) {
                        $('#userDialog').dialog('close');
                        $("#dg").datagrid("unselectAll");
                        $("#dg").datagrid("reload");
                    }else{
                        alert(msg+"失败");
                    }
                }
            });
        }else{
            alert('发布内容和标题不能为空');
        }
    }
    $(function(){
        $('#dg').datagrid({
            url:"/manage/listUsers",
            //在请求远程数据的时候发送额外的参数
            queryParams:{token:getCookie("token")},
            idField:'id',
            pagination:true,
            pageList:[5,10,15,20],
            pageSize:5,
            //顶部工具栏的DataGrid面板
            toolbar: [{
                iconCls: 'icon-add',
                text:'添加',
                handler: function(){
                    add();
                }
            },'-',{
                iconCls: 'icon-edit',
                text:'修改',
                handler: function(){
                    //判断是否选中记录
                    var rows = $("#dg").datagrid("getSelections");
                    if(rows.length != 1){
                        $.messager.show({
                            title:'错误提示',
                            msg:'一次只能修改一条语句',
                            timeout:2000,
                            showType:'slide',
                        });
                    }else if(rows.length == 1){
                        add();
                        $('#userForm').form('clear');
                        $('#userForm').form('load',{
                            id:rows[0].id,
                            avatar:rows[0].avatar,
                            email:rows[0].email,
                            integral:rows[0].integral,
                            locked:rows[0].locked,
                            password:rows[0].password,
                            top:rows[0].top,
                            user:rows[0].user,
                            wechat:rows[0].wechat
                        });
                        $("#id").attr('readonly', 'readonly');
                        $("#avatar").attr('readonly', 'readonly');
                        $("#email").attr('readonly', 'readonly');
                        $("#integral").attr('readonly', 'readonly');
                        $("#password").attr('readonly', 'readonly');
                        $("#top").attr('readonly', 'readonly');
                        $("#user").attr('readonly', 'readonly');
                        $("#wechat").attr('readonly', 'readonly');
                    }
                }
            },'-',{
                iconCls: 'icon-remove',
                text:'删除',
                handler: function(){
                    //1.判断是否有选中行记录
                    //getselections 返回所有被选中的行，当没有记录被选中的时候将返回一个空数组。
                    var rows = $("#dg").datagrid("getSelections");
                    //在屏幕右下角显示一条消息窗口。该选项参数是一个可配置的对象：
                    if(rows.length == 0){
                        $.messager.show({
                            title:'错误提示',
                            msg:'至少选择一条记录',
                            timeout:2000,
                            showType:'slide',
                        });
                    }else{
                        //提示是否确认删除 ，如果确认则执行删除业务逻辑
                        $.messager.confirm('确认','您确认想要删除记录吗？',function(r){
                            if (r){
                                //获取被选中的记录  然后从相应记录中获取id
                                var ids = "";
                                for( var i = 0;i<rows.length;i++){
                                    //获取id的拼接但是多一个逗号
                                    ids += rows[i].id + "," ;
                                }
                                //alert(ids);
                                //拼接id的值发送给后台
                                //从0开始截取到最后一个逗号为止，去除多余的一个逗号
                                ids = ids.substring(0, ids.lastIndexOf(","));
                                //发送ajax请求
                                $.post("category-deleteByIds.action",{ids:ids},function(result){
                                    if(result == "true"){
                                        //取消选中的所有行 不然会保留状态更新的时候会出现已经选中一条的情况
                                        $("#dg").datagrid("unselectAll");
                                        //如果删除成功 刷新当前页
                                        $("#dg").datagrid("reload");
                                    }else{
                                        $.messager.show({
                                            title:'删除异常',
                                            msg:'删除失败，请检查操作',
                                            timeout:2000,
                                            showType:'slide',
                                        });
                                    }
                                },"text");
                            }
                        });
                    }
                }
            }],

            frozenColumns:[[
                {field:'xyz',checkbox:true},
                {field:'id',title:'id',width:100},
            ]],
            columns:[[
                {field:'avatar',title:'头像',width:100,},
                {field:'email',title:'邮箱',width:100,align:'right', },
                {field:'integral',title:'积分',width:100,},
                {field:'locked',title:'封号',width:100,
                }, {field:'password',title:'密码',width:100,
                },{field:'top',title:'排行',width:100,
                }, {field:'user',title:'用户名',width:100,
                },{field:'wechat',title:'微信号',width:100,
                }
            ]],
        });
    });
</script>
</body>
</html>